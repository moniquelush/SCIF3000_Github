---
title: "method code"
author: "Rui Wang"
date: "`r Sys.Date()`"
output: html_document
---
# General Linear Model and Visualisation Final Draft
We need know how extract 2016 from bioclim
Also how to made the predictor plot prettier 
Know how to name layer/rivers
## Loading and Cleaning Data
### Loading Library 
```{r, message=FALSE}
library(readr)
library(raster)
library(dismo)
library(geodata)
library(graphics)
library(ggplot2)
library(dismo)
library(terra)
install.packages("tidyterra")
library(tidyterra)
library(dplyr)

```

### Environment Data
**Exterior Environment Data**
```{r}
population_density <- raster("population_density.tif")
rivers <- raster("rivers.tif")
tree_cover <- raster("tree_cover.tif")
sydney <- raster("sydney.tif")
sydney_extent <- extent(sydney)
```

**_Changing the extent of exterior environment data_**
```{r}
projection(rivers) <- CRS('+proj=longlat + datum=WGS84') 
```



**Downloading and Cleaning Bioclimate Data**
```{r}
#Downloading and stacking the bioclimate data 
aus_bio_data <- worldclim_country(country = "Australia", res=20, var = 'bio', path = "bioclim_data", year = "2016") #
bioclim_stack <- stack("bioclim_data/wc2.1_country/AUS_wc2.1_30s_bio.tif")
```

```{r warning=FALSE}
#Cutting the extent of the stack 
projection(bioclim_stack) <- CRS('+proj=longlat + datum=WGS84')
bioclim_stack <- raster::projectRaster(bioclim_stack,tree_cover) 
```

```{r}
#Extracting from the bioclimate_stack
#-Temperature
bio_1 <- raster(bioclim_stack, layer=1) #Annual Mean Temperature
bio_5 <- raster(bioclim_stack, layer=5) #Max Temperature of Warmest Month
bio_6 <- raster(bioclim_stack, layer=6) #Min Temperature of Coldest Month
bio_7 <- raster(bioclim_stack, layer=7) #Temperature Annual Range
#-Precipitation
bio_12 <- raster(bioclim_stack, layer=12) #Annual Precipitation
bio_13 <- raster(bioclim_stack, layer=13) #Precipitation of Wettest Month
bio_14 <- raster(bioclim_stack, layer=14) #Precipitation of Driest Month
bio_15 <- raster(bioclim_stack, layer=15) #Precipitation Seasonality
```

### Occurence Data
**Occurence Data** 
```{r, message=FALSE}
king_parrot <- read_csv("alisterus_scapularis.csv")
rock_pigeon <- read_csv("colombia_livia.csv")
laughing_kookaburra <- read_csv("dacelo_novaeguineae.csv")
noisy_miner <- read_csv("manorina_melanocephala.csv")
superb_lyrebird<- read_csv("menura_novaehollandiae.csv")
white_ibis<- read_csv("threskiornis_moluccus.csv")
rainbow_lorikeet<- read_csv("trichoglossus_haematodus.csv")
```

**Spatialising occurence data**
```{r}
coordinates(king_parrot) <- ~decimalLon+decimalLat 
projection(king_parrot) <- CRS('+proj=longlat + datum=WGS84')

coordinates(rock_pigeon) <- ~decimalLon+decimalLat 
projection(rock_pigeon) <- CRS('+proj=longlat + datum=WGS84')

coordinates(laughing_kookaburra) <- ~decimalLon+decimalLat 
projection(laughing_kookaburra) <- CRS('+proj=longlat + datum=WGS84')

coordinates(noisy_miner) <- ~decimalLon+decimalLat 
projection(noisy_miner) <- CRS('+proj=longlat + datum=WGS84')

coordinates(superb_lyrebird) <- ~decimalLon+decimalLat 
projection(superb_lyrebird) <- CRS('+proj=longlat + datum=WGS84')

coordinates(white_ibis) <- ~decimalLon+decimalLat 
projection(white_ibis) <- CRS('+proj=longlat + datum=WGS84')

coordinates(rainbow_lorikeet) <- ~decimalLon+decimalLat 
projection(rainbow_lorikeet) <- CRS('+proj=longlat + datum=WGS84')
```

## GLM
```{r}
bg_stack<-stack(tree_cover, population_density, rivers, bio_1, bio_5, bio_6, bio_7, bio_12, bio_13, bio_14, bio_15)
```

### King Parrot
**Background Data**
```{r}
bg_kp <- randomPoints(bg_stack, 500) #do different for each species - for independent 
```

**Environment Data**
```{r}
presval_kp <-  raster::extract(bg_stack, king_parrot)
absval_kp <- raster::extract(bg_stack, bg_kp) #do a lot of 
presback_kp <- c(rep(1, nrow(presval_kp)), rep(0, nrow(absval_kp)))
kp_sdmdata <- data.frame(cbind(presback_kp, rbind(presval_kp, absval_kp)))
```

```{r}
m_kp<-glm(presback_kp ~ tree_cover+population_density+rivers+wc2.1_30s_bio_1+ wc2.1_30s_bio_5+wc2.1_30s_bio_6+wc2.1_30s_bio_7+wc2.1_30s_bio_12+ wc2.1_30s_bio_13+wc2.1_30s_bio_14 + wc2.1_30s_bio_15, data=kp_sdmdata)
summary(m_kp)
```

```{r}
p_kp <- raster::predict(bg_stack, m_kp)
plot(p_kp) #We need to figure out how to made the map pretty

ggplot() +
  geom_spatraster(data = p_kp) +
  facet_wrap(~lyr) +
  scale_fill_whitebox_c(
    palette = "muted",
    na.value = "white")

```

### Rock Pigeon
**Background Data**
```{r}
bg_rp <- randomPoints(bg_stack, 500) #do different for each species - for independent 
```

**Environment Data**
```{r}
presval_rp <-  raster::extract(bg_stack, rock_pigeon)
absval_rp <- raster::extract(bg_stack, bg_rp) #do a lot of 
presback_rp <- c(rep(1, nrow(presval_rp)), rep(0, nrow(absval_rp)))
rp_sdmdata <- data.frame(cbind(presback_rp, rbind(presval_rp, absval_rp)))
```

```{r}
m_rp<-glm(presback_rp ~ tree_cover+population_density+rivers+wc2.1_30s_bio_1+ wc2.1_30s_bio_5+wc2.1_30s_bio_6+wc2.1_30s_bio_7+wc2.1_30s_bio_12+ wc2.1_30s_bio_13+wc2.1_30s_bio_14 + wc2.1_30s_bio_15, data=rp_sdmdata)
summary(m_rp)
```

```{r}
p_rp <- raster::predict(bg_stack, m_rp)
plot(p_rp) #We need to figure out how to made the map pretty
```

### Laughing Kookaburra
**Background Data**
```{r}
bg_lk <- randomPoints(bg_stack, 500) #do different for each species - for independent 
```

**Environment Data**
```{r}
presval_lk <-  raster::extract(bg_stack, laughing_kookaburra)
absval_lk <- raster::extract(bg_stack, bg_lk) #do a lot of 
presback_lk <- c(rep(1, nrow(presval_lk)), rep(0, nrow(absval_lk)))
lk_sdmdata <- data.frame(cbind(presback_lk, rbind(presval_lk, absval_lk)))
```

```{r}
m_lk<-glm(presback_lk ~ tree_cover+population_density+rivers+wc2.1_30s_bio_1+ wc2.1_30s_bio_5+wc2.1_30s_bio_6+wc2.1_30s_bio_7+wc2.1_30s_bio_12+ wc2.1_30s_bio_13+wc2.1_30s_bio_14 + wc2.1_30s_bio_15, data=lk_sdmdata)
summary(m_lk)
```

```{r}
p_lk <- raster::predict(bg_stack, m_lk)
plot(p_lk) #We need to figure out how to made the map pretty
```

### Noisy Miner
**Background Data**
```{r}
bg_nm <- randomPoints(bg_stack, 500) #do different for each species - for independent 
```

**Environment Data**
```{r}
presval_nm <-  raster::extract(bg_stack, noisy_miner)
absval_nm <- raster::extract(bg_stack, bg_nm) #do a lot of 
presback_nm <- c(rep(1, nrow(presval_nm)), rep(0, nrow(absval_nm)))
nm_sdmdata <- data.frame(cbind(presback_nm, rbind(presval_nm, absval_nm)))
```

```{r}
m_nm<-glm(presback_nm ~ tree_cover+population_density+rivers+wc2.1_30s_bio_1+ wc2.1_30s_bio_5+wc2.1_30s_bio_6+wc2.1_30s_bio_7+wc2.1_30s_bio_12+ wc2.1_30s_bio_13+wc2.1_30s_bio_14 + wc2.1_30s_bio_15, data=nm_sdmdata)
summary(m_nm)
```

```{r}
p_nm <- raster::predict(bg_stack, m_nm)
plot(p_nm) #We need to figure out how to made the map pretty
```

### Superb Lyrebird
**Background Data**
```{r}
bg_sl <- randomPoints(bg_stack, 500) #do different for each species - for independent 
```

**Environment Data**
```{r}
presval_sl <-  raster::extract(bg_stack, superb_lyrebird)
absval_sl <- raster::extract(bg_stack, bg_sl) #do a lot of 
presback_sl <- c(rep(1, nrow(presval_sl)), rep(0, nrow(absval_sl)))
sl_sdmdata <- data.frame(cbind(presback_sl, rbind(presval_sl, absval_sl)))
```

```{r}
m_sl<-glm(presback_sl ~ tree_cover+population_density+rivers+wc2.1_30s_bio_1+ wc2.1_30s_bio_5+wc2.1_30s_bio_6+wc2.1_30s_bio_7+wc2.1_30s_bio_12+ wc2.1_30s_bio_13+wc2.1_30s_bio_14 + wc2.1_30s_bio_15, data=sl_sdmdata)
summary(m_sl)
```

```{r}
p_sl <- raster::predict(bg_stack, m_sl)
plot(p_sl) #We need to figure out how to made the map pretty
```

### White Ibis
**Background Data**
```{r}
bg_wi <- randomPoints(bg_stack, 500) #do different for each species - for independent 
```

**Environment Data**
```{r}
presval_wi <-  raster::extract(bg_stack, white_ibis)
absval_wi <- raster::extract(bg_stack, bg_wi) #do a lot of 
presback_wi <- c(rep(1, nrow(presval_wi)), rep(0, nrow(absval_wi)))
wi_sdmdata <- data.frame(cbind(presback_wi, rbind(presval_wi, absval_wi)))
```

```{r}
m_wi<-glm(presback_wi ~ tree_cover+population_density+rivers+wc2.1_30s_bio_1+ wc2.1_30s_bio_5+wc2.1_30s_bio_6+wc2.1_30s_bio_7+wc2.1_30s_bio_12+ wc2.1_30s_bio_13+wc2.1_30s_bio_14 + wc2.1_30s_bio_15, data=wi_sdmdata)
summary(m_wi)
```

```{r}
p_wi <- raster::predict(bg_stack, m_wi)
plot(p_wi) #We need to figure out how to made the map pretty
```

### Rainbow Lorikeet
**Background Data**
```{r}
bg_rl <- randomPoints(bg_stack, 500) #do different for each species - for independent 
```

**Environment Data**
```{r}
presval_rl <-  raster::extract(bg_stack, rainbow_lorikeet)
absval_rl <- raster::extract(bg_stack, bg_rl) #do a lot of 
presback_rl <- c(rep(1, nrow(presval_rl)), rep(0, nrow(absval_rl)))
rl_sdmdata <- data.frame(cbind(presback_rl, rbind(presval_rl, absval_rl)))
```

```{r}
m_rl<-glm(presback_rl ~ tree_cover+population_density+rivers+wc2.1_30s_bio_1+ wc2.1_30s_bio_5+wc2.1_30s_bio_6+wc2.1_30s_bio_7+wc2.1_30s_bio_12+ wc2.1_30s_bio_13+wc2.1_30s_bio_14 + wc2.1_30s_bio_15, data=rl_sdmdata)
summary(m_rl)
```

```{r}
p_rl <- raster::predict(bg_stack, m_rl)
plot(p_rl) #We need to figure out how to made the map pretty
```
